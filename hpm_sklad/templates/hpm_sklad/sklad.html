{% extends "hpm_sklad/base_left_right_column.html" %}
{% load static %}
{% load custom_filters %}

{% block navbar %}
    <div class="col">
        <a class="btn btn-danger btn-sm" href="{% url 'sklad' %}">Sklad</a>
        <a class="btn btn-primary btn-sm" href="{% url 'audit_log' %}">Audit log</a>     
        |
        {% if perms.hpm_sklad.add_sklad %}
            <a class="btn btn-primary btn-sm" href="javascript:void(0);" onclick="loadForm('{% url 'create_sklad' %}')">Vytvoření položky</a>
        {% endif %}    
    </div>
    <div class="col-auto">   
        {% include "hpm_sklad/login.html" %}
    </div>
{% endblock %}

{% block left_content %}
    <form method="GET" action="">
        <div class="form-group small">
                <label>
                    <input type="radio" name="radio_filter" value="" {% if not request.GET.radio_filter or request.GET.radio_filter == '' %}checked{% endif %}> VŠE
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="hsh" {% if request.GET.radio_filter == 'hsh' %}checked{% endif %}> HSH
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="tq8" {% if request.GET.radio_filter == 'tq8' %}checked{% endif %}> TQ8
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="tqf_xl1" {% if request.GET.radio_filter == 'tqf_xl1' %}checked{% endif %}> TQF XL1
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="tqf_xl2" {% if request.GET.radio_filter == 'tqf_xl2' %}checked{% endif %}> TQF XL2
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="dc_xl" {% if request.GET.radio_filter == 'dc_xl' %}checked{% endif %}> DC XL
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="dac_xl1_2" {% if request.GET.radio_filter == 'dac_xl1_2' %}checked{% endif %}> DAC XL1-2
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="dl_xl" {% if request.GET.radio_filter == 'dl_xl' %}checked{% endif %}> DL XL
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="dac" {% if request.GET.radio_filter == 'dac' %}checked{% endif %}> DAC
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="lac_1" {% if request.GET.radio_filter == 'lac_1' %}checked{% endif %}> LAC 1
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="lac_2" {% if request.GET.radio_filter == 'lac_2' %}checked{% endif %}> LAC 2
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="ipsen_ene" {% if request.GET.radio_filter == 'ipsen_ene' %}checked{% endif %}> IPSEN ENE
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="hsh_ene" {% if request.GET.radio_filter == 'hsh_ene' %}checked{% endif %}> HSH ENE
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="xl_ene1" {% if request.GET.radio_filter == 'xl_ene1' %}checked{% endif %}> XL ENE1
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="xl_ene2" {% if request.GET.radio_filter == 'xl_ene2' %}checked{% endif %}> XL ENE2
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="ipsen_w" {% if request.GET.radio_filter == 'ipsen_w' %}checked{% endif %}> IPSEN W
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="hsh_w" {% if request.GET.radio_filter == 'hsh_w' %}checked{% endif %}> HSH W
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="kw" {% if request.GET.radio_filter == 'kw' %}checked{% endif %}> KW
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="kw1" {% if request.GET.radio_filter == 'kw1' %}checked{% endif %}> KW 1
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="kw2" {% if request.GET.radio_filter == 'kw2' %}checked{% endif %}> KW 2
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="kw3" {% if request.GET.radio_filter == 'kw3' %}checked{% endif %}> KW 3
                </label>
                <label>
                    <input type="radio" name="radio_filter" value="mikrof" {% if request.GET.radio_filter == 'mikrof' %}checked{% endif %}> MIKROF
                </label>
        </div>    
        <div class="form-group form-check">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" name="kriticky_dil" {% if request.GET.kriticky_dil == 'on' %}checked{% endif %}> Kritický díl
                </label>
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" name="ucetnictvi" {% if request.GET.ucetnictvi == 'on' %}checked{% endif %}> Účetnictví
                </label>
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input" name="pod_minimem" {% if request.GET.pod_minimem == 'on' %}checked{% endif %}> Pod minimem
                </label>
        </div>
        <div class="form-group"
                <input class="search" type="text" name="query" placeholder="Vyhledat název dílu" value="{{ request.GET.query }}">            
        </div>
                <input type="hidden" name="sort" value="{% if request.GET.sort %}{{ request.GET.sort }}{% else %}evidencni_cislo{% endif %}">
                <input type="hidden" name="order" value="{% if request.GET.order %}{{ request.GET.order }}{% else %}down{% endif %}">
                <button class="btn btn-primary btn-sm" type="submit">Filtrovat</button>
    </form>
    <div class="container-fluid">
        <table class="table table-sm table-hover table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    {% with request.GET.urlencode as querystring %}
                        <th scope="col">
                            <a href="?sort=evidencni_cislo&order={% if request.GET.sort == 'evidencni_cislo' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Ev. číslo
                                {% if request.GET.sort == 'evidencni_cislo' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                                {% if not request.GET.sort %}
                                    <i class="fas fa-sort-down"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=interne_cislo&order={% if request.GET.sort == 'interne_cislo' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Č. karty
                                {% if request.GET.sort == 'interne_cislo' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=nazev_dilu&order={% if request.GET.sort == 'nazev_dilu' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Název dílu
                                {% if request.GET.sort == 'nazev_dilu' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=min_mnozstvi_ks&order={% if request.GET.sort == 'min_mnozstvi_ks' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Min.
                                {% if request.GET.sort == 'min_mnozstvi_ks' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=mnozstvi&order={% if request.GET.sort == 'mnozstvi' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Množství
                                {% if request.GET.sort == 'mnozstvi' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=jednotky&order={% if request.GET.sort == 'jednotky' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Jedn.
                                {% if request.GET.sort == 'jednotky' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=umisteni&order={% if request.GET.sort == 'umisteni' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Umístění
                                {% if request.GET.sort == 'umisteni' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=dodavatel&order={% if request.GET.sort == 'dodavatel' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Dodavatel
                                {% if request.GET.sort == 'dodavatel' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=datum_nakupu&order={% if request.GET.sort == 'datum_nakupu' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Datum nákupu
                                {% if request.GET.sort == 'datum_nakupu' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=cislo_objednavky&order={% if request.GET.sort == 'cislo_objednavky' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Číslo obj.
                                {% if request.GET.sort == 'cislo_objednavky' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=jednotkova_cena_eur&order={% if request.GET.sort == 'jednotkova_cena_eur' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                EUR/ jedn.
                                {% if request.GET.sort == 'jednotkova_cena_eur' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=celkova_cena_eur&order={% if request.GET.sort == 'celkova_cena_eur' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Celkem EUR
                                {% if request.GET.sort == 'celkova_cena_eur' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=poznamka&order={% if request.GET.sort == 'poznamka' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Poznámka
                                {% if request.GET.sort == 'poznamka' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                    {% endwith %}
                </tr>
            </thead>
            <tbody class="show-pointer">
                {% for sklad in object_list %}
          	    <tr data-evidencni-cislo="{{ sklad.evidencni_cislo }}" data-detail-url="{% url 'detail_sklad' sklad.evidencni_cislo %}" onclick="loadDetail('{% url 'detail_sklad' sklad.evidencni_cislo %}', '{{ sklad.evidencni_cislo }}')"
          	    {% if sklad.evidencni_cislo == selected_sklad.evidencni_cislo %}class="table-info"{% endif %} {% if sklad.pod_minimem %} class="pod-minimem-row"{% endif %}>
          	        <td scope="row">{{ sklad.evidencni_cislo }}</td>
                	<td scope="row">{{ sklad.interne_cislo }}</td>
                	<td scope="row">{{ sklad.nazev_dilu|truncatechars:60 }}</td>
                	<td scope="row">{{ sklad.min_mnozstvi_ks }}</td>
             		<td scope="row">{{ sklad.mnozstvi }}</td>
	              	<td scope="row">{{ sklad.jednotky }}</td>
       		        <td scope="row">{{ sklad.umisteni }}</td>
       		        <td scope="row">{{ sklad.dodavatel|truncatechars:20 }}</td>
                  	<td scope="row">{{ sklad.datum_nakupu|date:"d.m.Y" }}</td>
                  	<td scope="row">{{ sklad.cislo_objednavky }}</td>
                  	<td scope="row">{{ sklad.jednotkova_cena_eur|floatformat:2 }}</td>
                	<td scope="row">{{ sklad.celkova_cena_eur|floatformat:2 }}</td>
                    <td scope="row">{{ sklad.poznamka|truncatechars:25 }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>    
    {% include "hpm_sklad/pagination.html" %}
{% endblock %}

{% block script %}
    {{ block.super }}
    <script src="{% static 'js/scripts.js' %}"></script>
{% endblock %}

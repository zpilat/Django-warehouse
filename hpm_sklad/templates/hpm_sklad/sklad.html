{% extends "hpm_sklad/base_left_right_column.html" %}
{% load static %}
{% load custom_filters %}

{% block left_content %}
    <form method="GET" action="">
        <!-- První řádek: radiobuttony -->
        <div class="form-group mx-sm-3 my-2">
            <div class="form-row small">
                {% for value, label in radio_filters %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="radio_filter" value="{{ value }}" {% if request.GET.radio_filter == value %}checked{% endif %}>
                        <label class="form-check-label">{{ label }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <!-- Druhý řádek: checkbuttony, vyhledávání a tlačítko -->
        <div class="form-group mx-sm-3 mb-2">
            <div class="form-row justify-content-center align-items-center small">
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input" name="kriticky_dil" {% if request.GET.kriticky_dil == 'on' %}checked{% endif %}>
                    <label class="form-check-label">Kritický díl</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input" name="ucetnictvi" {% if request.GET.ucetnictvi == 'on' %}checked{% endif %}>
                    <label class="form-check-label">Účetnictví</label>
                </div>
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input" name="pod_minimem" {% if request.GET.pod_minimem == 'on' %}checked{% endif %}>
                    <label class="form-check-label">Pod minimem</label>
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <input class="form-control form-control-sm" type="text" name="query" placeholder="Vyhledat název dílu" value="{{ request.GET.query }}">
                </div>
                <div class="form-group mx-sm-3 mb-2">
                    <button class="btn btn-dark btn-sm" type="submit">Filtrovat</button>
                </div>
            </div>
        </div>

        <input type="hidden" name="sort" value="{% if request.GET.sort %}{{ request.GET.sort }}{% else %}evidencni_cislo{% endif %}">
        <input type="hidden" name="order" value="{% if request.GET.order %}{{ request.GET.order }}{% else %}down{% endif %}">
    </form>
    
    <div class="container-fluid">
        <table class="table table-sm table-hover table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    {% with request.GET.urlencode as querystring %}
                        <th scope="col">
                            <a href="?sort=evidencni_cislo&order={% if request.GET.sort == 'evidencni_cislo' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Ev. číslo
                                {% if request.GET.sort == 'evidencni_cislo' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                                {% if not request.GET.sort %}
                                    <i class="fas fa-sort-down"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=interne_cislo&order={% if request.GET.sort == 'interne_cislo' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Č. karty
                                {% if request.GET.sort == 'interne_cislo' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=nazev_dilu&order={% if request.GET.sort == 'nazev_dilu' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Název dílu
                                {% if request.GET.sort == 'nazev_dilu' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=min_mnozstvi_ks&order={% if request.GET.sort == 'min_mnozstvi_ks' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Min.
                                {% if request.GET.sort == 'min_mnozstvi_ks' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=mnozstvi&order={% if request.GET.sort == 'mnozstvi' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Množství
                                {% if request.GET.sort == 'mnozstvi' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=jednotky&order={% if request.GET.sort == 'jednotky' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Jedn.
                                {% if request.GET.sort == 'jednotky' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=umisteni&order={% if request.GET.sort == 'umisteni' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Umístění
                                {% if request.GET.sort == 'umisteni' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=dodavatel&order={% if request.GET.sort == 'dodavatel' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Dodavatel
                                {% if request.GET.sort == 'dodavatel' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=datum_nakupu&order={% if request.GET.sort == 'datum_nakupu' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Datum nákupu
                                {% if request.GET.sort == 'datum_nakupu' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=cislo_objednavky&order={% if request.GET.sort == 'cislo_objednavky' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Číslo obj.
                                {% if request.GET.sort == 'cislo_objednavky' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=jednotkova_cena_eur&order={% if request.GET.sort == 'jednotkova_cena_eur' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                EUR/ jedn.
                                {% if request.GET.sort == 'jednotkova_cena_eur' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=celkova_cena_eur&order={% if request.GET.sort == 'celkova_cena_eur' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Celkem EUR
                                {% if request.GET.sort == 'celkova_cena_eur' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                        <th scope="col">
                            <a href="?sort=poznamka&order={% if request.GET.sort == 'poznamka' and request.GET.order == 'up' %}down{% else %}up{% endif %}&{{ querystring|url_remove_param:'sort,order' }}">
                                Poznámka
                                {% if request.GET.sort == 'poznamka' %}
                                    <i class="fas fa-sort-{{ request.GET.order }}"></i>
                                {% endif %}
                            </a>
                        </th>
                    {% endwith %}
                </tr>
            </thead>
            <tbody class="show-pointer">
                {% for sklad in object_list %}
          	    <tr data-evidencni-cislo="{{ sklad.evidencni_cislo }}" data-detail-url="{% url 'detail_sklad' sklad.evidencni_cislo %}" onclick="loadDetail('{% url 'detail_sklad' sklad.evidencni_cislo %}', '{{ sklad.evidencni_cislo }}')"
          	    {% if sklad.evidencni_cislo == selected_sklad.evidencni_cislo %}class="table-info"{% endif %} {% if sklad.pod_minimem %} class="pod-minimem-row"{% endif %}>
          	        <td scope="row">{{ sklad.evidencni_cislo }}</td>
                	<td scope="row">{{ sklad.interne_cislo }}</td>
                	<td scope="row">{{ sklad.nazev_dilu|truncatechars:60 }}</td>
                	<td scope="row">{{ sklad.min_mnozstvi_ks }}</td>
             		<td scope="row">{{ sklad.mnozstvi }}</td>
	              	<td scope="row">{{ sklad.jednotky }}</td>
       		        <td scope="row">{{ sklad.umisteni }}</td>
       		        <td scope="row">{{ sklad.dodavatel|truncatechars:20 }}</td>
                  	<td scope="row">{{ sklad.datum_nakupu|date:"d.m.Y" }}</td>
                  	<td scope="row">{{ sklad.cislo_objednavky }}</td>
                  	<td scope="row">{{ sklad.jednotkova_cena_eur|floatformat:2 }}</td>
                	<td scope="row">{{ sklad.celkova_cena_eur|floatformat:2 }}</td>
                    <td scope="row">{{ sklad.poznamka|truncatechars:25 }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>    
    {% include "hpm_sklad/pagination.html" %}
{% endblock %}

{% block script %}
    {{ block.super }}
    <script src="{% static 'js/scripts.js' %}"></script>
{% endblock %}
